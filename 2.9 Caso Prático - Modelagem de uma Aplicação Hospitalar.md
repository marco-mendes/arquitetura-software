### **Cenário - Plataforma de Evolução de Sistemas Hospitalares da ACME**

O hospital ACME enfrenta desafios significativos de negócio relacionados à fragmentação de sistemas, atrasos na troca de informações entre áreas críticas e dificuldade em manter a continuidade assistencial sem retrabalho ou redundância de dados. Problemas como prescrições não sincronizadas, resultados laboratoriais atrasados e falhas no controle de acesso impactam diretamente a qualidade do atendimento e a segurança do paciente.

Atualmente, o hospital possui 200 leitos ativos, incluindo 50 leitos de UTI e uma média de 1.500 mil atendimentos ambulatoriais por dia e 20.000 exames laboratoriais semanais. Cada médico atende em média 15 pacientes por dia, e a farmácia interna realiza aproximadamente 2.000 prescrições diárias. Durante surtos epidêmicos, a demanda pode aumentar até 80%, pressionando tanto os sistemas administrativos quanto os assistenciais.

Um novo projeto de arquitetura foi desenhado com metas arrojadas, apontadas abaixo:

* O tempo máximo aceitável para exibir resultados de exames ao médico deve ser de 2 segundos.
* Prescrições devem estar disponíveis para a farmácia em tempo real (< 1 segundo de latência).
* O sistema deve operar com 99,95% de disponibilidade anual.
* Toda transação deve registrar identificação do profissional envolvido, com rastreabilidade completa (auditoria).
* Dados de pacientes devem estar em conformidade com a LGPD, com criptografia obrigatória em trânsito e em repouso.
* A integração com convênios e sistemas regulatórios deve ocorrer em tempo real para autorizações críticas e em batch diário para relatórios financeiros.

Espera-se que a adoção de uma arquitetura moderna permita à TI prover uma base flexível, segura e escalável para digitalizar integralmente os processos clínicos e administrativos, promovendo maior agilidade no cuidado, redução de erros e maior integração com ecossistemas externos.

Você assumiu o papel de arquiteto de software incumbido de desenhar uma solução de backend para esse hospital. Sua responsabilidade é criar uma arquitetura coerente, que:

* Suporte comunicação eficiente entre módulos.
* Garanta consistência de dados clínicos e operacionais.
* Atenda aos requisitos quantitativos e restrições de negócio.
* Permita evolução modular, suportando crescimento e integrações futuras.

Os sistemas envolvidos englobam funções como:

* Gestão de Pacientes e Registros Clínicos (EHR).
* Agendamento de Consultas, Exames e Cirurgias.
* Emissão e Recepção de Resultados de Exames Laboratoriais.
* Prescrições e Controle de Medicamentos na Farmácia Hospitalar.
* Integração com Convênios, Sistemas Governamentais e Terceiros.


Um desenho do estado atual é mostrado abaixo.

<img width="391" alt="image" src="https://github.com/user-attachments/assets/19c6e22c-ddfe-4de2-a89f-8113c7bfe1a1" />


---

### **Desafio**

Desenvolver uma arquitetura que promova a integração entre esses sistemas com uso de estilos como APIs, serviços, microsserviços ou até mesmo eventos/filas de mensagens.

### **Questão 1 - Topologia de Integração**

Para iniciar, considere que cada sistema possa ser integrado através das seguintes formas:

#### 1. Integração Ponto a Ponto
**Definição:** Conexão direta entre dois sistemas, cada par se integra de forma específica.  

**Vantagens:**  
- Simples em cenários pequenos.  
- Baixo custo inicial.  
- Comunicação direta.  

**Desvantagens:**  
- Escala mal: cresce como “espaguete” conforme aumenta o número de integrações.  
- Manutenção difícil.  
- Pouca padronização.  

---

#### 2. Integração por Banco de Dados Compartilhado
**Definição:** Diferentes aplicações acessam diretamente o mesmo banco de dados e seu esquema.  

**Vantagens:**  
- Dados centralizados.  
- Menos redundância se bem controlado.  
- Relatórios unificados facilitados.  

**Desvantagens:**  
- Forte acoplamento ao schema.  
- Mudanças estruturais impactam vários sistemas.  
- Segurança e isolamento frágeis.  

---

#### 3. Integração por Serviços
**Definição:** Sistemas expõem funcionalidades por meio de contratos bem definidos (*services*), consumidos via diferentes protocolos (HTTP/REST, SOAP, gRPC, RMI, CORBA etc.).  

**Vantagens:**  
- Baixo acoplamento (contrato é a dependência).  
- Reuso em múltiplos canais.  
- Permite governança, versionamento e segurança.  
- Flexibilidade tecnológica entre sistemas.  

**Desvantagens:**  
- Pode gerar latência por chamadas remotas.  
- Exige disciplina no design e gestão de contratos.  
- Necessidade de infraestrutura de suporte (gateway, descoberta, autenticação).  

---

#### 4. Integração Orientada a Eventos/Mensagens
**Definição:** Comunicação assíncrona mediada por *message brokers* (Kafka, RabbitMQ, ActiveMQ), via publicação/consumo de mensagens ou eventos.  

**Vantagens:**  
- Desacoplamento forte (produtor não conhece consumidor).  
- Escalável e resiliente a falhas temporárias.  
- Habilita arquiteturas *event-driven*.  

**Desvantagens:**  
- Consistência eventual pode gerar desafios de negócio.  
- Rastreamento ponta a ponta é complexo.  
- Requer governança de tópicos, filas e erros.  

---

#### 5. Integração via ESB (Enterprise Service Bus)
**Definição:** Um barramento central que orquestra, transforma e roteia mensagens entre sistemas.  

**Vantagens:**  
- Padronização das integrações.  
- Centraliza regras de transformação e roteamento.  
- Reduz a complexidade ponto a ponto.  

**Desvantagens:**  
- Pode se tornar gargalo ou ponto único de falha.  
- Complexidade e custo de adoção altos.  
- Muitas vezes substituído por arquiteturas mais leves (APIs + eventos).  

---

#### 6. Integração via iPaaS (Integration Platform as a Service)
**Definição:** Plataformas em nuvem que oferecem conectores prontos e fluxos de integração (*low-code/no-code*).  

**Vantagens:**  
- Agilidade na entrega.  
- Conectores para SaaS comuns (Salesforce, SAP etc.).  
- Escalabilidade nativa em nuvem.  

**Desvantagens:**  
- Custo recorrente elevado.  
- Dependência do fornecedor (*vendor lock-in*).  
- Flexibilidade limitada em cenários muito específicos.  

---

#### Comparativo Rápido

| Estilo                     | Acoplamento | Escalabilidade | Governança | Complexidade |
|-----------------------------|-------------|----------------|------------|--------------|
| Ponto a ponto              | Alto        | Baixa          | Baixa      | Crescente    |
| Banco de dados compartilhado| Alto        | Média          | Alta       | Alta         |
| Serviços                   | Médio       | Média/Alta     | Média      | Média        |
| Eventos/Mensageria         | Baixo       | Alta           | Alta       | Alta         |
| ESB                        | Médio       | Média          | Alta       | Alta         |
| iPaaS                      | Médio/Baixo | Alta           | Média      | Média        |


#### Perguntas

* Proponha uma ou mais alternativas arquiteturais apropriadas (ex.: integração ponto a ponto, integração por banco de dados, integração por serviços, eventos, etc.)
* Justifique a escolha, considerando os requisitos apresentados

## **Questão 2 - Estilos Técnicos de APIs**

Agora considere os seguintes mecanismos técnicos de integração.

#### HTTP (Hypertext Transfer Protocol)
- **O que é:** Protocolo de requisição/resposta da web.  
- **Uso:** Base para navegadores, APIs e servidores.  
- **Prós:** Simples, universal, amplamente suportado.  
- **Contras:** Não é bidirecional nativo.  

---

#### REST (Representational State Transfer)
- **O que é:** Estilo arquitetural baseado em HTTP e recursos identificados por URIs.  
- **Uso:** APIs modernas (GET, POST, PUT, DELETE).  
- **Prós:** Simples, escalável, cacheável.  
- **Contras:** Pode exigir muitas chamadas; é um estilo, não um protocolo.  

---

###### WebSocket
- **O que é:** Protocolo full-duplex sobre TCP, iniciado via HTTP.  
- **Uso:** Comunicação em tempo real (chats, jogos).  
- **Prós:** Bidirecional, baixa latência.  
- **Contras:** Mais complexo de implementar e monitorar.  

---

#### SOAP (Simple Object Access Protocol)
- **O que é:** Protocolo baseado em XML para mensagens estruturadas.  
- **Uso:** Integrações corporativas legadas, contratos WSDL.  
- **Prós:** Tipagem forte, suporte a segurança e transações.  
- **Contras:** Verboso, rígido, dependente de XML.  

---

#### GraphQL
- **O que é:** Linguagem de consulta para APIs.  
- **Uso:** Cliente pede exatamente os dados que precisa.  
- **Prós:** Evita overfetching/underfetching.  
- **Contras:** Mais complexo de gerenciar no servidor; risco de queries pesadas.  

---

#### gRPC (Google Remote Procedure Call)
- **O que é:** Framework baseado em HTTP/2 e Protobuf.  
- **Uso:** Microserviços, streaming de dados.  
- **Prós:** Rápido, eficiente, suporta streaming.  
- **Contras:** Difícil depuração, menos suporte nativo em browsers.  

---

#### XML (eXtensible Markup Language)
- **O que é:** Formato de dados estruturado baseado em marcação.  
- **Uso:** SOAP, documentos corporativos.  
- **Prós:** Suporta schemas (XSD), validação forte.  
- **Contras:** Verboso, pouco eficiente.  

---

#### JSON (JavaScript Object Notation)
- **O que é:** Formato leve baseado em pares chave-valor.  
- **Uso:** APIs REST e integrações modernas.  
- **Prós:** Simples, leve, fácil de ler.  
- **Contras:** Validação fraca sem contratos claros.  

---

## Comparativo Rápido

| Estilo/Protocolo | Categoria | Pontos Fortes | Limitações |
|------------------|-----------|---------------|------------|
| **HTTP**         | Protocolo | Universal, simples | Não é bidirecional |
| **REST**         | Estilo    | Simples, cacheável | Muitas chamadas |
| **WebSocket**    | Protocolo | Tempo real, bidirecional | Complexidade maior |
| **SOAP**         | Protocolo | Contratos formais, segurança | Verbosidade |
| **GraphQL**      | Estilo    | Precisão na busca de dados | Controle complexo |
| **gRPC**         | Framework | Alta performance, streaming | Debug difícil |
| **XML**          | Formato   | Validação forte | Verbosidade |
| **JSON**         | Formato   | Leve, popular | Validação fraca |

#### Perguntas

* Proponha quais os mecanismos técnicos você irá usar para cada integração.
* Justifique a escolha, considerando os requisitos apresentados


### **Questão 3 - Modelagem C4**

Finalmente, vamos representar a sua proposta em dois diagramas do modelo C4:

* **Nível C1:** Diagrama de Contexto (usuários, sistemas internos e externos)
* **Nível C2:** Diagrama de Contêiner (comunicação entre módulos internos da solução)



